<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Central — Accueil</title>
  <link rel="stylesheet" href="styles.css?v=4" />
</head>
<body>
<header>
  <div class="brand"><img src="badge.png" alt="badge"><div class="title">SAINT-GEORGES SHERIFF</div></div>
  <div class="spread">
    <span id="clock" class="pill">--:--:--</span>
    <span id="who" class="pill">Non connecté</span>
    <button id="btn-login" class="btn gold hidden">Connexion</button>
    <button id="btn-logout" class="btn ghost hidden">Déconnexion</button>
  </div>
</header>

<!-- Login -->
<main class="container" id="page-login" style="display:none">
  <div class="card" style="max-width:620px;margin:32px auto">
    <div class="center" style="flex-direction:column;gap:10px;margin-bottom:12px">
      <img src="badge.png" style="height:80px;width:auto" alt="">
      <h1>Connexion</h1>
      <div class="muted">Email + mot de passe Supabase</div>
    </div>
    <div class="grid">
      <div class="grid-2">
        <div><label>Email</label><input id="login-email" placeholder="nom@exemple.com" autocomplete="username"></div>
        <div><label>Mot de passe</label><input id="login-pass" type="password" placeholder="••••••••" autocomplete="current-password"></div>
      </div>
      <button id="do-login" class="btn gold">Se connecter</button>
    </div>
  </div>
</main>

<!-- Home tiles -->
<main class="container" id="page-home" style="display:none">
  <div class="tiles">
    <a href="dispatch.html" class="tileLink"><div class="tileIcon">D</div><div><b>Dispatch</b><div class="muted small">Affectations en temps réel</div></div></a>
    <a href=compteur.html#" class="tileLink"><div class="tileIcon">C</div><div><b>Compteur effectifs</b><div class="muted small">Timings & séances</div></div></a>
    <a href="effectifs_org.html" class="tileLink"><div class="tileIcon">E</div><div><b>Effectifs</b><div class="muted small">Liste & statuts</div></div></a>
    <a href="admin.html" class="tileLink"><div class="tileIcon">A</div><div><b>Administration</b><div class="muted small">Gestion & droits</div></div></a>
    <a href="calculateur.html" class="tileLink"><div class="tileIcon">K</div><div><b>Calculateur</b><div class="muted small">Heures + judiciaires</div></div></a>
    <a href="fourriere.html" class="tileLink"><div class="tileIcon">F</div><div><b>Fourrière</b><div class="muted small">Immobilisations</div></div></a>
  </div>
</main>

<footer>© Sheriff’s Department — Saint-Georges</footer>

<script type="module">
  import { supabase, startClock, bindHeaderAuth } from './common.js';

  startClock();
  await bindHeaderAuth();

  const show = id => {
    document.getElementById("page-login").style.display = (id==='login') ? 'block' : 'none';
    document.getElementById("page-home").style.display  = (id==='home')  ? 'block' : 'none';
  };

  const { data: { session } } = await supabase.auth.getSession();
  const isLogin = location.hash === '#login' || !session?.user;
  show(isLogin ? 'login' : 'home');

  document.getElementById('do-login')?.addEventListener('click', async ()=>{
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-pass').value.trim();
    if(!email||!password) return alert("Email et mot de passe requis.");
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) alert(error.message); else show('home');
  });
</script>
<script type="module" src="common.js"></script>
</body>
</html>


